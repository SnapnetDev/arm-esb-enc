<?php
 namespace App\Services; class CrmService { private $tenantID = ''; private $clientID = ''; private $clientSecret = ''; private $crmUsername = ''; private $crmPassword = ''; private $crmResource = ''; private $token = ''; private $entitylistData = array(); private $input = array(); private $entity = ''; function withTenantID($tenantID) { $this->tenantID = $tenantID; return $this; } function withEntity($entity) { $this->entity = $entity; return $this; } function withClientID($clientID) { $this->clientID = $clientID; return $this; } function withClientSecret($clientSecret) { $this->clientSecret = $clientSecret; return $this; } function withCrmUsername($crmUsername) { $this->crmUsername = $crmUsername; return $this; } function withCrmPassword($crmPassword) { $this->crmPassword = $crmPassword; return $this; } function withCrmResource($crmResource) { $this->crmResource = $crmResource; return $this; } function loadToken() { $curl = curl_init(); $headers = array("\x48\157\163\x74\x3a\40\x6c\x6f\147\x69\156\56\x6d\x69\x63\x72\157\x73\x6f\146\164\x6f\x6e\x6c\x69\156\145\x2e\143\157\x6d"); $headers[] = "\103\157\156\164\145\x6e\164\55\x54\x79\x70\x65\x3a\40\141\x70\x70\154\151\143\141\x74\x69\x6f\x6e\x2f\x78\55\167\167\x77\55\x66\x6f\x72\x6d\x2d\x75\x72\x6c\145\x6e\x63\157\144\145\144"; $headers[] = "\101\x63\x63\145\160\x74\x3a\x61\x70\x70\154\x69\x63\x61\164\x69\157\156\57\152\x73\x6f\156\x3b\x20\143\x68\x61\x72\x73\145\164\x3d\x75\164\146\x2d\70"; $headers[] = "\117\104\141\164\141\55\x4d\x61\x78\x56\x65\x72\x73\151\157\x6e\x3a\64\x2e\x30"; $headers[] = "\x4f\x44\141\x74\141\55\x56\x65\162\x73\x69\157\156\72\64\x2e\60"; $body = array("\143\154\151\145\156\164\137\151\x64" => $this->clientID, "\x63\154\151\x65\156\164\137\163\x65\x63\162\145\x74" => $this->clientSecret, "\165\x73\x65\x72\156\x61\x6d\145" => $this->crmUsername, "\160\x61\x73\x73\167\x6f\x72\144" => $this->crmPassword, "\x67\162\x61\156\164\x5f\164\x79\160\x65" => "\x70\x61\163\x73\167\x6f\162\x64", "\x72\145\x73\x6f\x75\162\143\x65" => "\x68\x74\164\160\163\x3a\57\57" . $this->crmResource . "\x2e\x63\x72\x6d\x34\56\x64\x79\x6e\x61\x6d\151\143\163\56\x63\157\x6d\x2f"); $curlConfig = array(); $curlConfig[CURLOPT_URL] = "\150\164\164\160\x73\72\x2f\x2f\154\157\x67\151\x6e\x2e\x6d\x69\143\162\157\x73\x6f\146\164\x6f\156\154\x69\x6e\x65\x2e\143\x6f\x6d\x2f" . $this->tenantID . "\57\x6f\141\x75\164\x68\62\57\x74\x6f\x6b\x65\x6e"; $curlConfig[CURLOPT_RETURNTRANSFER] = true; $curlConfig[CURLOPT_ENCODING] = ''; $curlConfig[CURLOPT_MAXREDIRS] = 10; $curlConfig[CURLOPT_TIMEOUT] = 0; $curlConfig[CURLOPT_FOLLOWLOCATION] = true; $curlConfig[CURLOPT_HTTP_VERSION] = CURL_HTTP_VERSION_1_1; $curlConfig[CURLOPT_CUSTOMREQUEST] = "\x50\117\x53\124"; if (!empty($body)) { foreach ($body as $k => $v) { $postFields[] = "{$k}\75{$v}"; } $postFields = implode("\x26", $postFields); $curlConfig[CURLOPT_POSTFIELDS] = $postFields; } $curlConfig[CURLOPT_HTTPHEADER] = $headers; curl_setopt_array($curl, $curlConfig); $response = curl_exec($curl); curl_close($curl); $response = json_decode($response, $assoc = true); $this->token = "\x69\156\x76\x61\x6c\x69\144\x5f\164\x6f\153\145\x6e"; if (isset($response["\x61\143\143\145\x73\x73\137\164\157\x6b\145\x6e"])) { $this->token = $response["\141\x63\143\x65\163\163\137\x74\157\153\145\x6e"]; } return $this; } function getToken() { return $this->token; } function fetchEntity($filters = '', $size = 11) { $entity = $this->entity; if (!empty($filters)) { $filters = "\x3f\44\146\151\x6c\164\145\x72\x3d" . urlencode($filters); } $token = $this->token; $url = "\x68\x74\164\x70\163\72\x2f\x2f" . $this->crmResource . "\x2e\x63\x72\155\x34\x2e\x64\171\156\141\155\151\143\163\x2e\143\157\155\x2f\141\160\151\57\144\x61\164\x61\57\166\x39\56\61\x2f{$entity}{$filters}"; $url = trim($url); $curl = curl_init(); $headers[] = "\103\157\156\164\x65\x6e\164\55\124\x79\x70\145\x3a\40\x61\160\160\154\151\x63\141\x74\x69\x6f\156\57\152\x73\x6f\x6e\x3b\x20\143\150\141\x72\x73\145\164\x3d\x75\x74\146\55\x38"; $headers[] = "\x41\x63\143\x65\160\164\72\x61\x70\160\154\151\143\x61\x74\x69\157\156\x2f\152\x73\x6f\x6e"; $headers[] = "\x4f\x44\x61\164\x61\55\x4d\141\170\126\145\162\163\x69\x6f\x6e\72\64\x2e\60"; $headers[] = "\117\104\141\x74\141\x2d\x56\x65\162\163\151\157\x6e\72\x34\56\x30"; $headers[] = "\101\x75\164\x68\x6f\x72\x69\172\141\164\151\157\156\x3a\x42\145\x61\162\145\162\x20" . $token; $headers[] = "\x50\162\145\x66\145\162\72\x6f\144\x61\x74\x61\56\151\156\x63\154\x75\x64\145\x2d\141\156\x6e\x6f\x74\141\164\x69\157\156\x73\x3d\x22\52\x22\54\157\x64\141\164\141\x2e\x6d\x61\170\x70\x61\147\x65\x73\151\172\x65\x3d" . $size; $curlConfig = array(); $curlConfig[CURLOPT_URL] = $url; $curlConfig[CURLOPT_RETURNTRANSFER] = true; $curlConfig[CURLOPT_ENCODING] = ''; $curlConfig[CURLOPT_MAXREDIRS] = 10; $curlConfig[CURLOPT_TIMEOUT] = 0; $curlConfig[CURLOPT_FOLLOWLOCATION] = true; $curlConfig[CURLOPT_HTTP_VERSION] = CURL_HTTP_VERSION_1_1; $curlConfig[CURLOPT_CUSTOMREQUEST] = "\107\x45\x54"; $curlConfig[CURLOPT_HTTPHEADER] = $headers; curl_setopt_array($curl, $curlConfig); $response = curl_exec($curl); curl_close($curl); $response = json_decode($response, $assoc = true); $this->entitylistData = $response["\166\141\x6c\165\145"]; return $this; } function entityList() { return $this->entitylistData; } function withInputData($input = array()) { $this->input = $input; return $this; } function store() { $entity = $this->entity; $body = $this->input; $url = "\x68\x74\164\x70\x73\72\x2f\57" . $this->crmResource . "\x2e\x63\162\155\64\56\x64\171\x6e\x61\x6d\x69\x63\163\x2e\143\x6f\x6d\57\141\160\x69\x2f\144\x61\x74\x61\x2f\x76\x39\x2e\61\x2f{$entity}"; $curl = curl_init(); $headers[] = "\x43\157\x6e\164\x65\x6e\x74\x2d\124\171\x70\x65\72\x20\141\x70\160\x6c\151\x63\x61\164\x69\157\156\x2f\x6a\x73\x6f\156\x3b\x20\x63\150\x61\162\x73\145\x74\x3d\x75\164\x66\55\x38"; $headers[] = "\x41\x63\143\x65\x70\164\72\x61\x70\x70\x6c\151\x63\x61\164\151\x6f\156\57\x6a\x73\x6f\156\73\40\x63\150\x61\162\163\x65\164\75\165\x74\146\x2d\x38"; $headers[] = "\x4f\104\141\164\141\55\x4d\141\170\x56\x65\162\x73\151\x6f\x6e\72\64\x2e\60"; $headers[] = "\x4f\x44\x61\164\x61\x2d\126\x65\x72\163\x69\x6f\156\72\64\56\60"; $headers[] = "\101\165\x74\x68\x6f\x72\151\x7a\141\164\151\157\156\x3a\102\145\141\x72\145\x72\40" . $this->token; $curlConfig = array(); $curlConfig[CURLOPT_URL] = $url; $curlConfig[CURLOPT_RETURNTRANSFER] = true; $curlConfig[CURLOPT_ENCODING] = ''; $curlConfig[CURLOPT_MAXREDIRS] = 10; $curlConfig[CURLOPT_TIMEOUT] = 0; $curlConfig[CURLOPT_FOLLOWLOCATION] = true; $curlConfig[CURLOPT_HTTP_VERSION] = CURL_HTTP_VERSION_1_1; $curlConfig[CURLOPT_CUSTOMREQUEST] = "\x50\117\x53\124"; if (!empty($body)) { $postFields = json_encode($body); $curlConfig[CURLOPT_POSTFIELDS] = $postFields; } $curlConfig[CURLOPT_HTTPHEADER] = $headers; curl_setopt_array($curl, $curlConfig); $response = curl_exec($curl); curl_close($curl); $response = json_decode($response, $assoc = true); if ($response) { return $response; } return array("\x6d\x65\163\163\141\x67\145" => "\x4e\145\x77\40\145\156\164\162\171\40\143\x72\x65\x61\x74\x65\144\x20\x73\165\143\x63\x65\163\x73\x66\165\154\154\x79", "\145\162\x72\157\162" => false); } } ?>